generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum UserType {
  COORDINATOR
  VOLUNTEER
}

enum ScheduleStatus {
  PENDING
  CONFIRMED
  TRADE_REQUESTED
}

enum TradeRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ReportType {
  SCHEDULE_SUMMARY
  VOLUNTEER_STATUS
  MINISTRY_REPORT
}

model User {
  id         String     @id @default(uuid())
  name       String
  email      String     @unique
  phone      String
  cpf        String     @unique
  rg         String
  password   String
  userType   UserType
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  address    Address?
  ministries VolunteerMinistry[]
  schedulesCreated Schedule[] @relation("ScheduleCreatedBy")
  volunteerAssignments ScheduleVolunteer[]
  tradeRequests TradeRequest[] @relation("TradeRequestRequester")
  respondedTradeRequests TradeRequest[] @relation("TradeRequestResponder")
  reports    Report[]   @relation("ReportGeneratedBy")
}

model Address {
  id          String @id @default(uuid())
  street      String
  number      String
  complement  String?
  neighborhood String
  city        String
  state       String
  zipCode     String
  user        User   @relation(fields: [userId], references: [id])
  userId      String @unique
}

model Ministry {
  id          String   @id @default(uuid())
  name        String
  description String
  color       String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  volunteers  VolunteerMinistry[]
  schedules   Schedule[]
}

model VolunteerMinistry {
  volunteerId String
  ministryId  String
  assignedAt  DateTime @default(now())
  volunteer   User     @relation(fields: [volunteerId], references: [id])
  ministry    Ministry @relation(fields: [ministryId], references: [id])

  @@id([volunteerId, ministryId])
}

model Schedule {
  id          String    @id @default(uuid())
  date        DateTime
  time        String
  ministryId  String
  createdById String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  ministry    Ministry  @relation(fields: [ministryId], references: [id])
  createdBy   User      @relation("ScheduleCreatedBy", fields: [createdById], references: [id])
  volunteers  ScheduleVolunteer[]
  tradeRequests TradeRequest[]
}

model ScheduleVolunteer {
  scheduleId String
  volunteerId String
  status      ScheduleStatus @default(PENDING)
  confirmedAt DateTime?
  requestedChangeAt DateTime?
  requestedChangeReason String?
  volunteer  User     @relation(fields: [volunteerId], references: [id])
  schedule   Schedule @relation(fields: [scheduleId], references: [id])

  @@id([scheduleId, volunteerId])
}

model TradeRequest {
  id                     String             @id @default(uuid())
  scheduleId             String
  requestingVolunteerId  String
  reason                 String
  status                 TradeRequestStatus @default(PENDING)
  createdAt              DateTime           @default(now())
  respondedAt            DateTime?
  respondedById          String?
  schedule               Schedule           @relation(fields: [scheduleId], references: [id])
  requestingVolunteer    User               @relation("TradeRequestRequester", fields: [requestingVolunteerId], references: [id])
  respondedBy            User?              @relation("TradeRequestResponder", fields: [respondedById], references: [id])
}

model Report {
  id             String     @id @default(uuid())
  type           ReportType
  dateRangeStart DateTime
  dateRangeEnd   DateTime
  data           Json
  generatedById  String
  generatedAt    DateTime @default(now())
  generatedBy    User     @relation("ReportGeneratedBy", fields: [generatedById], references: [id])
}
